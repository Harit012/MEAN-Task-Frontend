import{a as te}from"./chunk-Y7MBL22L.js";import{a as Z}from"./chunk-AV6STA5B.js";import{a as ee}from"./chunk-GCUPY6YI.js";import{a as V,c as U,d as G,e as z,f as u,g as W,i as Y,j as q,l as J,m as K,r as Q}from"./chunk-MWPMWWIU.js";import{a as $,g as X,i as h}from"./chunk-ZFVO5NLJ.js";import{$ as T,Ab as n,Bb as v,Db as P,Ga as k,Ib as N,Ja as p,Jb as M,Ka as b,Mb as O,Ob as H,S as y,X as w,_a as D,cb as g,dc as j,gb as L,ha as x,hb as S,ia as R,ib as C,jb as _,jc as A,kb as t,lb as i,mb as s,nc as B,qb as F,sb as f,tb as E,ub as I}from"./chunk-Q57VKX57.js";var ne=(()=>{let o=class o{constructor(e){this.http=e}getAllRides(){return this.http.get(`${h.BASE_URL}/admin/rides/ride-history/getAllRides`)}getRidesForDownload(){return this.http.get(`${h.BASE_URL}/admin/rides/ride-history/getRidesForDownload`)}};o.\u0275fac=function(r){return new(r||o)(w($))},o.\u0275prov=y({token:o,factory:o.\u0275fac,providedIn:"root"});let m=o;return m})();var re=(()=>{let o=class o{constructor(){}downloadFile(e,r="Ride History"){let l=this.convertToCSV(e),d=new Blob([l],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(d),a.setAttribute("download",`${r}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a)}convertToCSV(e){e.forEach(a=>{a.source=a.source.replaceAll(","," "),a.destination=a.destination.replaceAll(","," "),a.time=a.time.replaceAll(","," ")});let r=e,l=Object.keys(r[0]).join(","),d=r.map(a=>Object.values(a).join(","));return`${l}
${d.join(`
`)}`}};o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=y({token:o,factory:o.\u0275fac,providedIn:"root"});let m=o;return m})();var ae=()=>[1,2,3,4,5];function se(m,o){if(m&1&&(t(0,"option",14),n(1),i()),m&2){let c=o.$implicit;I("value",c),p(),v(c)}}function de(m,o){m&1&&s(0,"i",90)}function me(m,o){if(m&1&&D(0,de,1,0,"i",90),m&2){let c=o.$implicit,e=E().$implicit;L(0,c<=e.rating?0:-1)}}function ce(m,o){if(m&1){let c=F();t(0,"div",31)(1,"div",72)(2,"p",73),n(3," \u20B9 "),t(4,"span",74),n(5),i()(),t(6,"p",75)(7,"span",76),n(8),i(),s(9,"i",77),t(10,"span",78),n(11),i()()(),t(12,"div",79)(13,"p"),s(14,"i",80),t(15,"span",81),n(16),i()(),t(17,"p"),s(18,"i",82),t(19,"span",83),n(20),i()(),t(21,"p"),s(22,"i",84),t(23,"span",85),n(24),O(25,"date"),i()()(),t(26,"div",86)(27,"button",87),f("click",function(){let r=x(c).$index,l=E();return R(l.onClickRide(r))}),n(28," More Details "),i(),t(29,"div",88),n(30),i(),t(31,"div",89),C(32,me,1,1,null,null,S),i()()()}if(m&2){let c=o.$implicit;g("ngClass",c.status=="cancelled"?"cancledRide":"completedRide"),p(5),v(c.price),p(3),v(c.source),p(3),v(c.destination),p(5),v(c.time),p(4),v(c.distance),p(4),P("",H(25,9,c.rideTime,"medium"),"(",c.rideType,")"),p(6),v(c.status),p(2),_(M(12,ae))}}var Ee=(()=>{let o=class o{constructor(e,r,l,d,a){this.rideSocketService=e,this.rideHistoryService=r,this.csvExportService=l,this.vehicleTypeService=d,this.toasr=a,this.rideList=[],this.mainRideList=[],this.userProfile="",this.selectedRide={_id:"--",destination:"--",source:"--",time:"--",distance:0,serviceType:"--",paymentMethod:"--",rideTime:"--",price:"--",driverProfit:"--",stops:[],stopPoints:[],endPoints:[],userName:"--",userPhone:"--",rideId:"--",rideType:"--",userProfile:"--",status:"--",driverId:"--",driverName:"--",sourceCity:"--"},this.vehicleTypes=[],this.selectedType="all",this.selectedStatus="all",this.endPoints=[],this.rideForm=new z({source:new u(null),destination:new u(null),price:new u(null),distance:new u(null),time:new u(null),username:new u(null),userphone:new u(null),servicetype:new u(null),paymentmethod:new u(null),ridetime:new u(null),rideid:new u(null),sourceCity:new u(null),driverName:new u(null)})}ngOnInit(){this.rideHistoryService.getAllRides().subscribe({next:e=>{this.mainRideList=e.rides,this.rideList=e.rides}}),this.rideSocketService.cancleRide().subscribe(e=>{this.mainRideList.unshift(e),this.onClickFilter()}),this.rideSocketService.onCompeteRide().subscribe(e=>{this.mainRideList.unshift(e),this.onClickFilter()}),this.vehicleTypeService.getAllVehicleTypes().subscribe({next:e=>{this.vehicleTypes=e.allVehicleTypes}})}initMap(){let e=new google.maps.LatLngBounds;this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:52.7572,lng:12.8022},zoom:10,mapId:"8f2d9c7f9f9f8a9f"}),new google.maps.Polyline({path:this.endPoints,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(this.map),this.endPoints.forEach(l=>{e.extend(l)}),this.map.fitBounds(e)}onClickRide(e){this.rideForm.disable(),this.selectedRide=this.rideList[e],this.endPoints=this.rideList[e].endPoints,this.initMap(),this.rideForm.patchValue({source:this.rideList[e].source,destination:this.rideList[e].destination,price:this.rideList[e].price,distance:this.rideList[e].distance,time:this.rideList[e].time,username:this.rideList[e].userName,userphone:this.rideList[e].userPhone,ridetime:this.rideList[e].rideTime,rideid:this.rideList[e].rideId,paymentmethod:this.rideList[e].paymentMethod,servicetype:this.rideList[e].serviceType,sourceCity:this.rideList[e].sourceCity,driverName:this.rideList[e].driverName?this.rideList[e].driverName:"no Driver Assigned"}),this.userProfile=`${h.BASE_URL}${this.rideList[e].userProfile}`,ee.getOrCreateInstance(document.getElementById("rideHistoryModal")).show()}onSearchInputChange(e){if(e.target.value=="")this.rideList=this.mainRideList;else{let r=new RegExp(e.target.value,"ig"),l=this.rideList.filter(d=>d.source.search(r)>-1||d.destination.search(r)>-1||d.userName.search(r)>-1);this.rideList=l}}onDownload(){this.rideHistoryService.getRidesForDownload().subscribe({next:e=>{this.csvExportService.downloadFile(e.rides)}})}onFromDateChange(e){this.fromDate=new Date(e.target.value);let r=new Date;this.fromDate>r&&(this.toasr.warning("Date should not be greater than current date","Warning",h.TROASTR_STYLE),this.clearFrom())}onToDateChange(e){this.toDate=new Date(e.target.value);let r=new Date;this.toDate>r&&(this.toasr.warning("Date should not be greater than current date","Warning",h.TROASTR_STYLE),this.clearTo())}onTypeChange(e){this.selectedType=e.target.value}onStatusChange(e){this.selectedStatus=e.target.value}onClickFilter(){let e=!1,r=!1,l=!1;this.toDate!=null&&this.fromDate!=null?this.toDate>this.fromDate?this.rideList=this.mainRideList.filter(d=>{let a=new Date(d.rideTime);return this.fromDate<=a&&this.toDate>=a?e=!0:e=!1,this.selectedType!="all"?r=d.serviceType==this.selectedType:r=!0,this.selectedStatus!="all"?l=d.status==this.selectedStatus:l=!0,e&&r&&l}):(this.toasr.warning("To date should be greater than From date","Warning",h.TROASTR_STYLE),this.clearFrom(),this.clearTo()):this.toDate==null&&this.fromDate==null?this.rideList=this.mainRideList.filter(d=>(this.selectedType!="all"?r=d.serviceType==this.selectedType:r=!0,this.selectedStatus!="all"?l=d.status==this.selectedStatus:l=!0,r&&l)):(this.toDate==null||this.fromDate==null)&&this.toasr.warning("Please select both dates","Warning",h.TROASTR_STYLE)}clearFrom(){let e=document.getElementById("from");e.value="",this.fromDate=void 0}clearTo(){let e=document.getElementById("to");e.value="",this.toDate=void 0}};o.\u0275fac=function(r){return new(r||o)(b(Z),b(ne),b(re),b(te),b(X))},o.\u0275cmp=T({type:o,selectors:[["app-ride-history"]],standalone:!0,features:[N],decls:141,vars:3,consts:[[1,"container",2,"width","84dvw"],[1,"row","p-2","d-flex","justify-content-between","bg-dark","text-white"],[1,"col-4"],[1,"col-4","align-self-center"],["type","search","name","","id","searchRide","placeholder","Search (username / source / destination / drivername)",1,"form-control",3,"input"],[1,"row","justify-content-between"],[1,"col-1","align-self-center"],[1,"fas","fa-filter","fs-4"],[1,"d-flex","mb-3"],[1,"col-2"],["for","status",1,"fs-6",2,"font-weight","700"],[1,"col-9"],["name","","id","status",1,"form-select","ms-2",3,"change"],["value","all",3,"defaultSelected"],[3,"value"],[1,"d-flex","m-1"],["value","all"],["value","cancelled"],["value","completed"],[1,"row"],[1,"m-1","d-flex","mb-3"],["for","from",1,"fs-6",2,"font-weight","700"],["type","date","id","from",1,"form-control","ms-1",3,"change"],[1,"btn","btn-danger","ms-2",3,"click"],["type","date","id","to",1,"form-control","ms-1",3,"change"],[1,"btn","btn-warning","btn-large","font-weight-bold",3,"click"],[1,"fas","fa-filter"],[1,"btn","btn-dark","mt-4","font-weight-bold",3,"click"],[1,"fas","fa-download"],[1,"row","p-2"],[1,"scrollable-section"],[1,"row","ride-details","justify-content-between","border-3","corners",3,"ngClass"],["id","rideHistoryModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"container"],[3,"formGroup"],[1,"row","mt-2"],["for","userProfile",1,"col-4","label"],[1,"col-8"],["alt","","height","100","width","150",3,"src"],["for","username",1,"col-4","align-self-center","label"],["type","text","id","username","value","blank","formControlName","username",1,"form-control"],["type","text","id","driverName","value","blank","formControlName","driverName",1,"form-control"],["for","userphone",1,"col-4","align-self-center","label"],["type","text","id","userphone","value","blank","formControlName","userphone",1,"form-control"],["for","source",1,"col-4","align-self-center","label"],["type","text","id","source","value","blank","formControlName","source",1,"form-control"],["for","destination",1,"col-4","align-self-center","label"],["type","text","id","destination","value","blank","formControlName","destination",1,"form-control"],["for","price",1,"col-4","align-self-center","label"],["type","text","id","price","value","blank","formControlName","price",1,"form-control"],["for","distance",1,"col-4","align-self-center","label"],["type","text","id","distance","value","blank","formControlName","distance",1,"form-control"],["for","time",1,"col-4","align-self-center","label"],["type","text","id","time","value","blank","formControlName","time",1,"form-control"],["for","ridetime",1,"col-4","align-self-center","label"],["type","text","id","ridetime","value","blank","formControlName","ridetime",1,"form-control"],["for","riservicetypedetime",1,"col-4","align-self-center","label"],["type","text","id","servicetype","value","blank","formControlName","servicetype",1,"form-control"],["for","paymentmethod",1,"col-4","align-self-center","label"],["type","text","id","paymentmethod","value","blank","formControlName","paymentmethod",1,"form-control"],["for","rideid",1,"col-4","align-self-center","label"],["type","text","id","rideid","value","blank","formControlName","rideid",1,"form-control"],[1,"row","mt-3"],["id","map"],[1,"modal-footer","d-flex","justify-content-center"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],[1,"col-md-4","col-sm-6","price-source"],[1,"price","fs-4"],["id","ridePrice"],[1,"source-destination"],["id","rideSource ",1,"fs-5"],[1,"fas","fa-arrow-right","ms-2","me-2"],["id","rideDestination",1,"fs-5"],[1,"col-md-3","col-sm-6","estimated-time","d-none","d-md-block"],[1,"fas","fa-clock"],["id","estimatedTime",1,"rideInfo"],[1,"fa-duotone","fa-solid","fa-route"],["id","distance",1,"rideInfo"],[1,"fas","fa-calendar-alt"],["id","rideTime",1,"rideInfo"],[1,"col-md-2","col-sm-6","d-none","d-md-block"],["type","button",1,"btn","btn-info","w-100","mt-2",3,"click"],[1,"w-100","mt-2","fs-4","ms-2"],[1,"w-100","mt-2"],[1,"fas","fa-star","fs-4",2,"color","#1e42d4"]],template:function(r,l){r&1&&(t(0,"div",0)(1,"div",1)(2,"h1",2),n(3,"Ride History"),i(),t(4,"div",3)(5,"input",4),f("input",function(a){return l.onSearchInputChange(a)}),i()()(),s(6,"hr"),t(7,"div",5)(8,"div",6),s(9,"i",7),i(),t(10,"div",2)(11,"div",8)(12,"div",9)(13,"label",10),n(14,"Types :- "),i()(),t(15,"div",11)(16,"select",12),f("change",function(a){return l.onTypeChange(a)}),t(17,"option",13),n(18,"All"),i(),C(19,se,2,2,"option",14,S),i()()(),t(21,"div",15)(22,"div",9)(23,"label",10),n(24,"Status :- "),i()(),t(25,"div",11)(26,"select",12),f("change",function(a){return l.onStatusChange(a)}),t(27,"option",16),n(28,"All"),i(),t(29,"option",17),n(30,"Cancelled"),i(),t(31,"option",18),n(32,"Completed"),i()()()()(),t(33,"div",2)(34,"div",19)(35,"div",20)(36,"div",9)(37,"label",21),n(38,"From :- "),i()(),t(39,"input",22),f("change",function(a){return l.onFromDateChange(a)}),i(),t(40,"button",23),f("click",function(){return l.clearFrom()}),n(41," Clear "),i()(),t(42,"div",20)(43,"div",9)(44,"label",21),n(45,"to :- "),i()(),t(46,"input",24),f("change",function(a){return l.onToDateChange(a)}),i(),t(47,"button",23),f("click",function(){return l.clearTo()}),n(48,"Clear"),i()()()(),t(49,"div",9)(50,"button",25),f("click",function(){return l.onClickFilter()}),s(51,"i",26),n(52," Filter Data "),i(),t(53,"button",27),f("click",function(){return l.onDownload()}),s(54,"i",28),n(55," Download(SVG) "),i()()(),s(56,"hr"),t(57,"div",29)(58,"div",30),C(59,ce,34,13,"div",31,S),i()()(),t(61,"div",32)(62,"div",33)(63,"div",34)(64,"div",35)(65,"h1",36),n(66,"About Ride"),i(),s(67,"button",37),i(),t(68,"div",38)(69,"div",39)(70,"form",40)(71,"div",41)(72,"label",42),n(73,"User Profile"),i(),t(74,"div",43),s(75,"img",44),i()(),t(76,"div",41)(77,"label",45),n(78,"Cust. Name "),i(),t(79,"div",43),s(80,"input",46),i()(),t(81,"div",41)(82,"label",45),n(83,"Driver Name "),i(),t(84,"div",43),s(85,"input",47),i()(),t(86,"div",41)(87,"label",48),n(88,"Cust. Phone "),i(),t(89,"div",43),s(90,"input",49),i()(),t(91,"div",41)(92,"label",50),n(93,"Source "),i(),t(94,"div",43),s(95,"input",51),i()(),t(96,"div",41)(97,"label",52),n(98,"Destination "),i(),t(99,"div",43),s(100,"input",53),i()(),t(101,"div",41)(102,"label",54),n(103,"Price "),i(),t(104,"div",43),s(105,"input",55),i()(),t(106,"div",41)(107,"label",56),n(108,"Distance "),i(),t(109,"div",43),s(110,"input",57),i()(),t(111,"div",41)(112,"label",58),n(113,"Time "),i(),t(114,"div",43),s(115,"input",59),i()(),t(116,"div",41)(117,"label",60),n(118,"Ride Time "),i(),t(119,"div",43),s(120,"input",61),i()(),t(121,"div",41)(122,"label",62),n(123,"Service Type "),i(),t(124,"div",43),s(125,"input",63),i()(),t(126,"div",41)(127,"label",64),n(128,"Payment method "),i(),t(129,"div",43),s(130,"input",65),i()(),t(131,"div",41)(132,"label",66),n(133,"Ride ID "),i(),t(134,"div",43),s(135,"input",67),i()(),t(136,"div",68),s(137,"div",69),i()()()(),t(138,"div",70)(139,"button",71),n(140," Close "),i()()()()()),r&2&&(p(17),g("defaultSelected",!0),p(2),_(l.vehicleTypes),p(40),_(l.rideList),p(11),g("formGroup",l.rideForm),p(5),g("src",l.userProfile,k))},dependencies:[B,j,A,Q,W,J,K,V,U,G,Y,q],styles:[".ride-details[_ngcontent-%COMP%]{margin:10px;display:flex;align-items:center;padding:1rem;border:1px solid #2b282876}.price-source[_ngcontent-%COMP%]{font-weight:700}.price[_ngcontent-%COMP%]{margin-bottom:.5rem;color:#6a0768}.rideInfo[_ngcontent-%COMP%]{margin-left:10px}.scrollable-section[_ngcontent-%COMP%]{height:66dvh;overflow-y:scroll}.label[_ngcontent-%COMP%]{font-weight:600;font-size:medium;align-self:center;color:#696969ba}.label-2[_ngcontent-%COMP%]{font-weight:600;font-size:large;align-self:center;color:#424040f5}.corners[_ngcontent-%COMP%]{border-radius:40px}#map[_ngcontent-%COMP%]{height:300px;width:100%;background-color:brown}.driver-details[_ngcontent-%COMP%]{font-size:large;color:#3e3c3cce}.cancledRide[_ngcontent-%COMP%]{background-color:#ff000039}.completedRide[_ngcontent-%COMP%]{background-color:#00800039}"]});let m=o;return m})();export{Ee as RideHistoryComponent};
