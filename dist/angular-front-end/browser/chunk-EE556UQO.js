import{a as oe}from"./chunk-Y7MBL22L.js";import{a as le}from"./chunk-AV6STA5B.js";import{a as g}from"./chunk-GCUPY6YI.js";import{a as Y,c as q,d as K,e as J,f as p,g as Q,i as X,j as Z,l as ee,m as te,q as ie,r as ne}from"./chunk-MWPMWWIU.js";import{a as W,g as re,i as u}from"./chunk-ZFVO5NLJ.js";import{$ as N,Ab as n,Bb as v,Cb as M,Db as $,Ga as w,Ib as L,Ja as m,Jb as j,Ka as R,Mb as V,Ob as G,S as F,X as B,_a as O,cb as x,dc as U,gb as D,ha as S,hb as T,ia as _,ib as y,jb as C,jc as z,kb as t,lb as i,mb as a,nc as H,qb as I,sb as f,tb as h,ub as A,vb as P}from"./chunk-Q57VKX57.js";var E=class{static addGoogleApi(){let s=document.createElement("script");s.src=`https://maps.googleapis.com/maps/api/js?key=${u.GOOGLE_MAPS_API_KEY}&libraries=marker,places,drawing,geometry&v=weekly&loading=async`,s.type="text/javascript",document.body.appendChild(s)}};var se=(()=>{let s=class s{constructor(e){this.http=e}getAllDrivers(e,r,l){let c={cityId:e,serviceType:r,rideId:l};return this.http.get(`${u.BASE_URL}/admin/rides/confirmed-ride/getAllDrivers`,{params:c})}getRides(){return this.http.get(`${u.BASE_URL}/admin/rides/confirmed-ride/getRides`)}cancleRide(e){return this.http.patch(`${u.BASE_URL}/admin/rides/confirmed-ride/cancel-ride`,{rideId:e})}assignDriver(e,r){return this.http.patch(`${u.BASE_URL}/admin/rides/confirmed-ride/assign-driver`,{rideId:e,driverId:r})}assignAnyDriver(e){return this.http.patch(`${u.BASE_URL}/admin/rides/confirmed-ride/assign-any-driver`,{rideId:e})}getTimeOut(){return this.http.get(`${u.BASE_URL}/admin/rides/confirmed-ride/getTimeOut`)}};s.\u0275fac=function(r){return new(r||s)(B(W))},s.\u0275prov=F({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var me=(d,s)=>s._id,ce=()=>({btn:!0,"btn-secondary":!0});function pe(d,s){if(d&1&&(t(0,"option",20),n(1),i()),d&2){let o=s.$implicit;A("value",o),m(),v(o)}}function ue(d,s){if(d&1){let o=I();t(0,"div",85)(1,"button",86),f("click",function(){S(o);let r=h().$index,l=h();return _(l.onClickRide(r))}),n(2," More Details "),i(),t(3,"button",87),f("click",function(){S(o);let r=h().$implicit,l=h();return _(l.onAssignRide(r._id))}),n(4," Assign "),i(),t(5,"button",88),f("click",function(){S(o);let r=h().$implicit,l=h();return _(l.onRejectRide(r._id))}),n(6," Reject "),i()()}if(d&2){let o=h().$implicit;m(3),P("id","rideButton",o._id,"")}}function ve(d,s){if(d&1&&(t(0,"div",85)(1,"div",89),n(2),i(),t(3,"div",89),n(4),i()()),d&2){let o=h().$implicit;m(2),M('Driver : "',o.driverName,'"'),m(2),M("Status : ",o.status,"")}}function fe(d,s){if(d&1&&(t(0,"div",23)(1,"div",71)(2,"p",72),n(3," \u20B9 "),t(4,"span",73),n(5),i()(),t(6,"p",74)(7,"span",75),n(8),i(),a(9,"i",76),t(10,"span",77),n(11),i()()(),t(12,"div",78)(13,"p"),a(14,"i",79),t(15,"span",80),n(16),i()(),t(17,"p"),a(18,"i",81),t(19,"span",82),n(20),i()(),t(21,"p"),a(22,"i",83),t(23,"span",84),n(24),V(25,"date"),i()()(),O(26,ue,7,2,"div",85)(27,ve,5,2),i()),d&2){let o=s.$implicit;m(5),v(o.price),m(3),v(o.source),m(3),v(o.destination),m(5),v(o.time),m(4),v(o.distance),m(4),$("",G(25,8,o.rideTime,"medium"),"(",o.rideType,")"),m(2),D(26,o.status=="available"||o.status=="assignedToAny"||o.status=="assignedToOne"?26:27)}}function he(d,s){if(d&1){let o=I();t(0,"div",33)(1,"div",90),a(2,"img",91),i(),t(3,"div",92)(4,"p",93),n(5),i()(),t(6,"div",92)(7,"p",93),n(8),i()(),t(9,"div",92)(10,"p",93),n(11),i()(),t(12,"div",92)(13,"p",93),n(14),i()(),t(15,"div",92)(16,"button",94),f("click",function(){let r=S(o).$index,l=h();return _(l.onAssignDriverManually(r))}),n(17," Assign ride "),i()()()}if(d&2){let o=s.$implicit;m(2),P("src","http://44.201.133.98:3000/",o.driverProfile,"",w),A("alt",o.driverName),m(3),v(o.driverName),m(3),v(o.serviceType),m(3),v(o.phone),m(3),v(o.driverEmail),m(2),x("ngClass",j(8,ce))}}var Pe=(()=>{let s=class s{constructor(e,r,l,c){this.confirmedRideService=e,this.rideSocketService=r,this.toastr=l,this.vehicleTypeService=c,this.availableRides=[],this.totalRides=[],this.driversList=[],this.serviceTypes=[],this.timeOut=10,this.selectedRideForAssign={_id:"--",destination:"--",source:"--",time:"--",distance:0,serviceType:"--",paymentMethod:"--",rideTime:"--",price:"--",driverProfit:"--",stops:[],stopPoints:[],endPoints:[],userName:"--",userPhone:"--",rideId:"--",rideType:"--",userProfile:"--",status:"--",driverId:"--",driverName:"--",sourceCity:"--"},this.subscriptions=[],this.selectedServiceType="all",this.selectedstatus="all",this.endPoints=[],this.stopPoints=[],E.addGoogleApi(),this.confirmedRideForm=new J({source:new p(null),destination:new p(null),price:new p(null),distance:new p(null),time:new p(null),username:new p(null),userphone:new p(null),servicetype:new p(null),paymentmethod:new p(null),ridetime:new p(null),rideid:new p(null),sourceCity:new p(null)})}ngOnInit(){this.confirmedRideService.getRides().subscribe({next:e=>{this.totalRides=e.rides,this.availableRides=e.rides}}),this.vehicleTypeService.getAllVehicleTypes().subscribe({next:e=>{this.serviceTypes=e.allVehicleTypes}}),this.rideSocketService.getNewRide().subscribe(e=>{this.totalRides.unshift(e),this.onFilterRides()}),this.rideSocketService.cancleRide().subscribe(e=>{let r=g.getOrCreateInstance(document.getElementById("AssignModal"));this.totalRides=this.totalRides.filter(l=>e._id!=l._id),r.hide(),this.onFilterRides()}),this.rideSocketService.getAssignedRide().subscribe(e=>{g.getOrCreateInstance(document.getElementById("AssignModal")).hide();let l=document.getElementById(`rideButton${e._id}`);l.classList.add("btn-warning"),l.disabled=!0,l.textContent=`Assignig to ${e.driverName}`}),this.rideSocketService.getAcceptedRide().subscribe(e=>{this.totalRides=this.totalRides.filter(r=>r._id!=e._id),this.totalRides.push(e),this.onFilterRides()}),this.rideSocketService.onCronStop().subscribe(e=>{if(e.message=="All Drivers are Busy"){let r=document.getElementById(`rideButton${e.rideId}`);r.classList.remove("btn-warning"),r.disabled=!1,r.textContent="Re Assign"}}),this.rideSocketService.onCompeteRide().subscribe(e=>{this.totalRides=this.totalRides.filter(r=>r._id!=e._id),this.onFilterRides()}),this.rideSocketService.getStatusChange().subscribe(e=>{this.totalRides=this.totalRides.filter(r=>r._id!=e._id),this.totalRides.push(e),this.onFilterRides()}),this.rideSocketService.onHoldRide().subscribe(e=>{g.getOrCreateInstance(document.getElementById("AssignModal")).hide();let l=document.getElementById(`rideButton${e}`);l.classList.add("btn-warning"),l.disabled=!0,l.textContent="on Hold"})}onClickRide(e){this.confirmedRideForm.disable(),this.selectedRideForAssign=this.availableRides[e],this.endPoints=this.availableRides[e].endPoints,this.stopPoints=this.availableRides[e].stopPoints,this.initMap(),this.confirmedRideForm.patchValue({source:this.availableRides[e].source,destination:this.availableRides[e].destination,price:this.availableRides[e].price,distance:this.availableRides[e].distance,time:this.availableRides[e].time,username:this.availableRides[e].userName,userphone:this.availableRides[e].userPhone,ridetime:this.availableRides[e].rideTime,rideid:this.availableRides[e].rideId,paymentmethod:this.availableRides[e].paymentMethod,servicetype:this.availableRides[e].serviceType,userProfile:this.availableRides[e].userProfile,sourceCity:this.availableRides[e].sourceCity}),this.userProfile=`${u.BASE_URL}${this.availableRides[e].userProfile}`,g.getOrCreateInstance(document.getElementById("confirmedRideModal")).show()}onRejectRide(e){this.confirmedRideService.cancleRide(e).subscribe({next:r=>{this.toastr.success("Ride Canceled","Success",u.TROASTR_STYLE)}})}onAssignRide(e){let r=this.availableRides.filter(c=>c._id==e);this.selectedRideForAssign=r[0],this.confirmedRideService.getAllDrivers(this.selectedRideForAssign.sourceCity,this.selectedRideForAssign.serviceType,this.selectedRideForAssign._id).subscribe({next:c=>{this.driversList=c.driversList}}),g.getOrCreateInstance(document.getElementById("AssignModal")).show(),this.confirmedRideService.getTimeOut().subscribe({next:c=>{this.timeOut=c.timeOut}})}onSearchInputChange(e){let r=e.target.value;this.availableRides=this.totalRides.filter(l=>RegExp(r).exec(l.userName)||RegExp(r).exec(l.userPhone)||RegExp(r).exec(l.rideId)||RegExp(r).exec(l.rideTime))}onServiceTypeChange(e){this.selectedServiceType=e.target.value,console.log(this.selectedServiceType)}onStatusChange(e){this.selectedstatus=e.target.value,console.log(this.selectedstatus)}onFilterRides(){this.availableRides=this.totalRides.filter(e=>{let r=!1,l=!1;return this.selectedServiceType!="all"?r=e.serviceType==this.selectedServiceType:r=!0,this.selectedstatus!="all"?l=e.status==this.selectedstatus:l=!0,r&&l})}initMap(){let e=new google.maps.LatLngBounds;this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:52.7572,lng:12.8022},zoom:10,mapId:"8f2d9c7f9f9f8a9f"});let r=new google.maps.DirectionsService,l={origin:this.endPoints[0],destination:this.endPoints[1],travelMode:google.maps.TravelMode.DRIVING,waypoints:this.stopPoints.map(c=>({location:c,stopover:!0})),optimizeWaypoints:!0};this.directionsRenderer=new google.maps.DirectionsRenderer({hideRouteList:!0,polylineOptions:{strokeColor:"green",strokeOpacity:1,strokeWeight:3}}),r.route(l,(c,b)=>{this.directionsRenderer.setMap(this.map),this.directionsRenderer.setDirections(c),this.endPoints.forEach(k=>{e.extend(k)}),this.stopPoints.forEach(k=>{e.extend(k)}),this.map.fitBounds(e)})}onAssignDriverManually(e){this.confirmedRideService.assignDriver(this.selectedRideForAssign._id,this.driversList[e]._id).subscribe()}onAssignDriverAuto(){this.confirmedRideService.assignAnyDriver(this.selectedRideForAssign._id).subscribe({next:e=>{}})}};s.\u0275fac=function(r){return new(r||s)(R(se),R(le),R(re),R(oe))},s.\u0275cmp=N({type:s,selectors:[["app-confirmed-rides"]],standalone:!0,features:[L],decls:156,vars:2,consts:[[1,"container","p-0",2,"width","calc(100dvw - 262px)"],[1,"row","p-2","d-flex","justify-content-between","bg-dark","text-white"],[1,"col-4"],[1,"col-4","align-self-center"],["type","search","name","","id","searchRide","placeholder","Search",1,"form-control",3,"input"],[1,"row","mt-2","p-2"],[1,"col-5","d-flex"],["for","status",1,"label-2","me-3"],[1,"fa","fa-filter","me-1"],[1,"col-8"],["name","status","id","status",1,"form-select",3,"change"],["value","all"],["value","available"],["value","accepted"],["value","arrived"],["value","picked"],["value","started"],["value","completed"],["for","servicetype",1,"label-2","me-3"],["name","servicetype","id","servicetype",1,"form-select",3,"change"],[3,"value"],[1,"col-2","btn","btn-dark",3,"click"],["id","list",1,"scrollable-section"],[1,"row","ride-details","justify-content-between","border-3","corners"],["id","confirmedRideModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"container"],[3,"formGroup"],[1,"row","mt-2"],["for","userProfile",1,"col-4","label"],["alt","","height","100","width","150",3,"src"],["for","username",1,"col-4","align-self-center","label"],["type","text","id","username","value","blank","formControlName","username",1,"form-control"],["for","userphone",1,"col-4","align-self-center","label"],["type","text","id","userphone","value","blank","formControlName","userphone",1,"form-control"],["for","source",1,"col-4","align-self-center","label"],["type","text","id","source","value","blank","formControlName","source",1,"form-control"],["for","destination",1,"col-4","align-self-center","label"],["type","text","id","destination","value","blank","formControlName","destination",1,"form-control"],["for","price",1,"col-4","align-self-center","label"],["type","text","id","price","value","blank","formControlName","price",1,"form-control"],["for","distance",1,"col-4","align-self-center","label"],["type","text","id","distance","value","blank","formControlName","distance",1,"form-control"],["for","time",1,"col-4","align-self-center","label"],["type","text","id","time","value","blank","formControlName","time",1,"form-control"],["for","ridetime",1,"col-4","align-self-center","label"],["type","text","id","ridetime","value","blank","formControlName","ridetime",1,"form-control"],["for","riservicetypedetime",1,"col-4","align-self-center","label"],["type","text","id","servicetype","value","blank","formControlName","servicetype",1,"form-control"],["for","paymentmethod",1,"col-4","align-self-center","label"],["type","text","id","paymentmethod","value","blank","formControlName","paymentmethod",1,"form-control"],["for","rideid",1,"col-4","align-self-center","label"],["type","text","id","rideid","value","blank","formControlName","rideid",1,"form-control"],[1,"row","mt-3"],["id","map"],[1,"modal-footer","d-flex","justify-content-center"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger"],["id","AssignModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade","modal-xl"],[1,"modal-header","d-flex","justify-content-between"],["id","staticBackdropLabel",1,"modal-title","fs-5"],["id","remainingTime",1,"modal-title","ms-5","fs-5","text-bold"],[1,"row","border-bottom"],[1,"col-2","label-2"],[1,"row","mt-2","mb-2"],["type","button",1,"col-2","offset-5","btn","btn-success",3,"click"],[1,"modal-footer","justify-content-center"],[1,"col-md-4","col-sm-6","price-source"],[1,"price","fs-4"],["id","ridePrice"],[1,"source-destination"],["id","rideSource ",1,"fs-5"],[1,"fas","fa-arrow-right","ms-2","me-2"],["id","rideDestination",1,"fs-5"],[1,"col-md-3","col-sm-6","estimated-time","d-none","d-md-block"],[1,"fas","fa-clock"],["id","estimatedTime",1,"rideInfo"],[1,"fa-duotone","fa-solid","fa-route"],["id","distance",1,"rideInfo"],[1,"fas","fa-calendar-alt"],["id","rideTime",1,"rideInfo"],[1,"col-md-2","col-sm-6","d-none","d-md-block"],["type","button",1,"btn","btn-info","w-100","mt-2",3,"click"],["type","button",1,"btn","btn-success","w-100","mt-2",3,"click","id"],["type","button","id","rideButton",1,"btn","btn-danger","w-100","mt-2",3,"click"],[1,"w-100","mt-2"],[1,"col-2"],["height","80%","width","80%",3,"src","alt"],[1,"col-2","align-self-center"],[1,"driver-details"],["id","AssignButton",3,"click","ngClass"]],template:function(r,l){r&1&&(t(0,"div",0)(1,"div",1)(2,"h1",2),n(3,"Confirmed Rides"),i(),t(4,"div",3)(5,"input",4),f("input",function(b){return l.onSearchInputChange(b)}),i()()(),t(6,"div",5)(7,"div",6)(8,"label",7),a(9,"i",8),n(10,"Status"),i(),t(11,"div",9)(12,"select",10),f("change",function(b){return l.onStatusChange(b)}),t(13,"option",11),n(14,"All"),i(),t(15,"option",12),n(16,"Available"),i(),t(17,"option",13),n(18,"Accepted"),i(),t(19,"option",14),n(20,"Arrived"),i(),t(21,"option",15),n(22,"Picked"),i(),t(23,"option",16),n(24,"Started"),i(),t(25,"option",17),n(26,"Completed"),i()()()(),t(27,"div",6)(28,"label",18),a(29,"i",8),n(30," Service Type"),i(),t(31,"div",9)(32,"select",19),f("change",function(b){return l.onServiceTypeChange(b)}),t(33,"option",11),n(34,"All"),i(),y(35,pe,2,2,"option",20,T),i()()(),t(37,"button",21),f("click",function(){return l.onFilterRides()}),n(38," Filter results "),i()(),a(39,"hr"),t(40,"div",22),y(41,fe,28,11,"div",23,me),i()(),t(43,"div",24)(44,"div",25)(45,"div",26)(46,"div",27)(47,"h1",28),n(48,"About Ride"),i(),a(49,"button",29),i(),t(50,"div",30)(51,"div",31)(52,"form",32)(53,"div",33)(54,"label",34),n(55,"User Profile"),i(),t(56,"div",9),a(57,"img",35),i()(),t(58,"div",33)(59,"label",36),n(60,"Cust. Name "),i(),t(61,"div",9),a(62,"input",37),i()(),t(63,"div",33)(64,"label",38),n(65,"Cust. Phone "),i(),t(66,"div",9),a(67,"input",39),i()(),t(68,"div",33)(69,"label",40),n(70,"Source "),i(),t(71,"div",9),a(72,"input",41),i()(),t(73,"div",33)(74,"label",42),n(75,"Destination "),i(),t(76,"div",9),a(77,"input",43),i()(),t(78,"div",33)(79,"label",44),n(80,"Price "),i(),t(81,"div",9),a(82,"input",45),i()(),t(83,"div",33)(84,"label",46),n(85,"Distance "),i(),t(86,"div",9),a(87,"input",47),i()(),t(88,"div",33)(89,"label",48),n(90,"Time "),i(),t(91,"div",9),a(92,"input",49),i()(),t(93,"div",33)(94,"label",50),n(95,"Ride Time "),i(),t(96,"div",9),a(97,"input",51),i()(),t(98,"div",33)(99,"label",52),n(100,"Service Type "),i(),t(101,"div",9),a(102,"input",53),i()(),t(103,"div",33)(104,"label",54),n(105,"Payment method "),i(),t(106,"div",9),a(107,"input",55),i()(),t(108,"div",33)(109,"label",56),n(110,"Ride ID "),i(),t(111,"div",9),a(112,"input",57),i()(),t(113,"div",58),a(114,"div",59),i()()()(),t(115,"div",60)(116,"button",61),n(117," Close "),i()()()()(),t(118,"div",62)(119,"div",25)(120,"div",26)(121,"div",63)(122,"h1",64),n(123,"Assign Driver"),i(),a(124,"p",65)(125,"button",29),i(),t(126,"div",30)(127,"div",31)(128,"div",66)(129,"div",67)(130,"p"),n(131,"Driver Profile"),i()(),t(132,"div",67)(133,"p"),n(134,"Name"),i()(),t(135,"div",67)(136,"p"),n(137,"ServiceType"),i()(),t(138,"div",67)(139,"p"),n(140,"Phone"),i()(),t(141,"div",67)(142,"p"),n(143,"Email"),i()(),t(144,"div",67)(145,"p"),n(146,"Assign"),i()()(),y(147,he,18,9,"div",33,T),i(),a(149,"hr"),t(150,"div",68)(151,"button",69),f("click",function(){return l.onAssignDriverAuto()}),n(152," Assign to any available "),i()()(),t(153,"div",70)(154,"button",61),n(155," Close "),i()()()()()),r&2&&(m(35),C(l.serviceTypes),m(6),C(l.availableRides),m(11),x("formGroup",l.confirmedRideForm),m(5),x("src",l.userProfile,w),m(90),C(l.driversList))},dependencies:[H,U,z,ne,Q,ee,te,Y,q,K,X,Z,ie],styles:[".ride-details[_ngcontent-%COMP%]{margin:10px;display:flex;align-items:center;padding:1rem;border:1px solid #2b282876;background-color:#41474238}.price-source[_ngcontent-%COMP%]{font-weight:700}.price[_ngcontent-%COMP%]{margin-bottom:.5rem;color:#107e17}.rideInfo[_ngcontent-%COMP%]{margin-left:10px}.scrollable-section[_ngcontent-%COMP%]{height:75dvh;overflow-y:scroll}.label[_ngcontent-%COMP%]{font-weight:600;font-size:medium;align-self:center;color:#696969ba}.label-2[_ngcontent-%COMP%]{font-weight:600;font-size:large;align-self:center;color:#424040f5}.corners[_ngcontent-%COMP%]{border-radius:40px}#map[_ngcontent-%COMP%]{height:300px;width:100%;background-color:brown}.driver-details[_ngcontent-%COMP%]{font-size:large;color:#3e3c3cce}"]});let d=s;return d})();export{Pe as ConfirmedRidesComponent};
