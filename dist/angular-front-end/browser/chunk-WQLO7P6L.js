import{a as A}from"./chunk-FWL53F53.js";import{a as B}from"./chunk-NIHIRCKG.js";import{d as I,g as P,l as L,m as F,r as V}from"./chunk-MWPMWWIU.js";import{g as R,i as C}from"./chunk-ZFVO5NLJ.js";import{$ as M,Ab as d,Bb as x,Cb as O,Ib as k,Ja as c,Ka as b,Y as S,_a as f,bb as N,cb as v,ec as z,gb as w,ha as p,ia as m,kb as n,lb as r,mb as T,nc as Z,qb as _,sb as u,tb as g,ub as E}from"./chunk-Q57VKX57.js";function Y(o,s){if(o&1&&(n(0,"option",20),d(1),r()),o&2){let a=s.$implicit;E("value",a.countryShortName),c(),O(" ",a.countryName," ")}}function j(o,s){if(o&1){let a=_();n(0,"div",22),u("click",function(){let t=p(a).index,i=g(2);return m(i.onEditZone(t))}),n(1,"div",23)(2,"span",24),d(3),r(),n(4,"span",24),d(5),r()()()}if(o&2){let a=s.$implicit,e=s.index;c(),N("title",a.zoneName),c(2),x(e+1),c(2),x(a.zoneName.split(",")[0])}}function G(o,s){if(o&1&&f(0,j,6,3,"div",21),o&2){let a=g();v("ngForOf",a.filteredZones)}}function D(o,s){o&1&&(n(0,"div",25)(1,"h5"),d(2,"Select The Country"),r()())}function W(o,s){o&1&&(n(0,"div",25)(1,"h5"),d(2,"No Data Found"),r()())}function $(o,s){if(o&1){let a=_();n(0,"div",26)(1,"button",27),u("click",function(){p(a);let t=g();return m(t.addNewZone())}),d(2," Save "),r()(),n(3,"div",26)(4,"button",28),u("click",function(){p(a);let t=g();return m(t.resetMap())}),d(5," Reset Map "),r()()}}function J(o,s){if(o&1){let a=_();n(0,"div",26)(1,"button",29),u("click",function(){p(a);let t=g();return m(t.editZone())}),d(2," Update "),r()(),n(3,"div",26)(4,"button",28),u("click",function(){p(a);let t=g();return m(t.leaveEditMode())}),d(5," Leave Edit "),r()()}}var re=(()=>{let s=class s{constructor(e,t){this.countryService=e,this.cityService=t,this.countries=[],this.center={lat:22,lng:72},this.polyCoordinates=[],this.updatedPolyCoordinates=[],this.filteredZones=[],this.editId="",this.editMode=!1,this.zoneName="",this.countryName="",this.countryShortName="",this.googleMapStyles=[{elementType:"geometry",stylers:[{color:"#1d2c4d"}]},{elementType:"labels.text.fill",stylers:[{color:"#8ec3b9"}]},{elementType:"labels.text.stroke",stylers:[{color:"#1a3646"}]},{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#64779e"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{color:"#334e87"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#023e58"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#283d6a"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#6f9ba5"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#023e58"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#3C7680"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#304a7d"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#98a5be"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#2c6675"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#255763"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#b0d5ce"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#023e58"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#98a5be"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#283d6a"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#3a4762"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0e1626"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#ededed"}]},{featureType:"water",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#4e6d70"}]}],this.toastr=S(R)}ngOnInit(){this.countryService.getCountries().subscribe({next:e=>{e.countries&&e.countries.forEach(i=>{this.countries.push({_id:i._id,countryName:i.countryName,countryShortName:i.countryShortName,countryLatLng:i.latlng})})}}),this.initMap()}onCountryChanged(e){let t=e.target.value;for(let l of this.countries)l.countryShortName==t&&(this.selectedCountry=l);this.map.setCenter(this.selectedCountry.countryLatLng),this.map.setZoom(6),this.editMode=!1,document.getElementById("cityForm").reset(),this.googleAutoComplete(e.target.value),this.getZone()}googleAutoComplete(e){let t=document.getElementById("searchcity"),i=new google.maps.places.Autocomplete(t,{componentRestrictions:{country:e},types:["(cities)"]});i.addListener("place_changed",()=>{let l=i.getPlace(),h=l.address_components;this.drawingManager.setOptions({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0}),h.forEach(y=>{y.types.includes("country")?(h=y.long_name,this.countryShortName=y.short_name,this.countryName=h):y.types.includes("administrative_area_level_1")&&(this.zoneName=y.long_name)}),this.zoneName=l.name+","+this.zoneName,this.map.setCenter(l.geometry?.location?.toJSON()),this.map.setZoom(10)})}initMap(){this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:22.3039,lng:70.8022},zoom:10,styles:this.googleMapStyles}),this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]},polygonOptions:{zIndex:1,strokeWeight:2,strokeColor:"rgb(255, 255, 0)",fillColor:"rgb(255, 255, 0)"}}),this.drawingManager.setMap(this.map),this.drawingManager.setOptions({drawingMode:null,drawingControl:!1}),google.maps.event.addListener(this.drawingManager,"overlaycomplete",e=>{this.polygon&&this.polygon.setMap(null),e.type===google.maps.drawing.OverlayType.POLYGON&&(this.polygon=e.overlay,this.polyCoordinates=this.polygon.getPath().getArray().map(t=>({lat:t.lat(),lng:t.lng()})))})}logPolygonCoordinates(e){let t=e.getPath(),i=[];for(let l=0;l<t.getLength();l++){let h=t.getAt(l).toJSON();i.push(h)}this.updatedPolyCoordinates=i}onEditZone(e){this.drawingManager.setOptions({drawingMode:null,drawingControl:!1});let t=document.getElementById("searchcity");t.value=this.filteredZones[e].zoneName;let i=this.filteredZones[e];this.updatedInputIndex=e,this.editMode=!0,this.map.panTo(i.boundry[0]),this.map.setZoom(9),this.editId=i._id,this.editedpolygon=new google.maps.Polygon({paths:i.boundry,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0}),this.editedpolygon.setMap(this.map);let l=this.editedpolygon.getPath();l.addListener("set_at",()=>this.logPolygonCoordinates(this.editedpolygon)),l.addListener("insert_at",()=>this.logPolygonCoordinates(this.editedpolygon))}resetMap(){if(confirm("Are you sure want to reset map?")){let e=document.getElementById("searchcity");this.zoneName="",e.value="",this.polygon.setMap(null),this.map.panTo(this.center)}else return}leaveEditMode(){if(confirm("Are you sure want to leave Edit Mode ?")){let e=document.getElementById("searchcity");e.value="",this.editMode=!1,this.editedpolygon.setMap(null),this.map.panTo(this.center)}else return}editZone(){this.updatedPolyCoordinates.length>2&&this.editId!=""?(this.cityService.updateZone({boundry:this.updatedPolyCoordinates,id:this.editId}).subscribe({next:e=>{e.zone&&(this.filteredZones[this.updatedInputIndex]=e.zone,this.toastr.success(`Zone ${e.zone.zoneName} updated`,"Success",C.TROASTR_STYLE))}}),this.updatedPolyCoordinates=[],this.editMode=!1,this.editedpolygon.setMap(null),this.map.panTo(this.center)):this.toastr.warning("Values are Not Valid","Warning",C.TROASTR_STYLE)}addNewZone(){let e=document.getElementById("searchcity"),t=this.polyCoordinates;if(t.length>2||this.zoneName==""){let i={zoneName:this.zoneName,boundry:t,country:this.selectedCountry._id};this.cityService.addZone(i).subscribe({next:l=>{l.zones&&(this.filteredZones=l.zones,this.toastr.success(`Zone ${i.zoneName} added`,"Success",C.TROASTR_STYLE),this.zoneName="",this.polygon.setMap(null),this.map.panTo({lat:22.3039,lng:70.8022}),this.drawingManager.setOptions({drawingMode:null,drawingControl:!1}),this.map.setCenter(this.selectedCountry.countryLatLng),this.map.setZoom(6),e.value="")}})}else this.toastr.warning("Zone has no boundries","Warning",C.TROASTR_STYLE)}getZone(){this.cityService.getZones(this.selectedCountry._id).subscribe({next:e=>{e.zones&&(this.filteredZones=e.zones)}})}};s.\u0275fac=function(t){return new(t||s)(b(B),b(A))},s.\u0275cmp=M({type:s,selectors:[["app-city"]],standalone:!0,features:[k],decls:33,vars:4,consts:[["city",""],[1,"container",2,"width","100dvw"],[1,"row","mb-3","mt-3"],["for","country",1,"offset-3","col-3"],[1,"fs-5"],[1,"col-3"],["name","country","id","country",1,"form-select",3,"change"],["disabled","",3,"defaultSelected"],[3,"value",4,"ngFor","ngForOf"],[1,"row","d-flex"],["id","cityForm"],["for","searchcity",1,"offset-3","col-3"],["type","text","name","city","id","searchcity",1,"ms-3","col-3",2,"height","2.5rem","width","19rem"],[1,"row","mt-3"],[1,"col-8","align-self-center","me-2"],["id","map",2,"height","60vh","width","100%"],["id","registeredzones",2,"width","100%"],[1,"mb-2",2,"font-weight","700"],[1,"scrollable-section",2,"width","23dvw"],[1,"row","mt-3","d-flex","justify-content-center"],[3,"value"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["data-toggle","tooltip",1,"mb-2","align-content-center","cityBox"],[1,"ms-3",2,"font-size","larger"],[1,"row","text-align-center","align-self-center","ms-5",2,"height","60vh","align-content","center","justify-content","center"],[1,"col-2"],[1,"btn","btn-large","btn-dark",2,"height","3rem","width","5rem","font-size","large",3,"click"],[1,"btn","btn-large","btn-danger",2,"height","3rem","width","7rem","font-size","large",3,"click"],[1,"btn","btn-large","btn-dark",2,"height","3rem","width","8rem","font-size","large",3,"click"]],template:function(t,i){if(t&1){let l=_();n(0,"div",1)(1,"div",2)(2,"label",3)(3,"b",4),d(4,"Country :- "),r()(),n(5,"div",5)(6,"select",6),u("change",function(y){return p(l),m(i.onCountryChanged(y))}),n(7,"option",7),d(8,"Select Country"),r(),f(9,Y,2,2,"option",8),r()()(),n(10,"div",9)(11,"form",10)(12,"label",11)(13,"b",4),d(14,"City :- "),r()(),T(15,"input",12,0),r()(),T(17,"hr"),n(18,"div",13)(19,"div",14),T(20,"div",15),r(),n(21,"div",5)(22,"div",16)(23,"h3",17),d(24,"Registered Zones"),r(),n(25,"div",18),f(26,G,1,1,"div")(27,D,3,0)(28,W,3,0),r()()()(),T(29,"hr"),n(30,"div",19),f(31,$,6,0)(32,J,6,0),r()()}t&2&&(c(7),v("defaultSelected",!0),c(2),v("ngForOf",i.countries),c(17),w(26,i.filteredZones.length>0?26:i.selectedCountry==null?27:28),c(5),w(31,i.editMode?32:31))},dependencies:[Z,z,V,P,L,F,I],styles:["hr[_ngcontent-%COMP%]{height:3px;background-color:#000}.scrollable-section[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;overflow-x:auto}.cityBox[_ngcontent-%COMP%]{height:5rem;width:100%;background-color:#0954b6;border-radius:20px;color:#f0f8ff;cursor:pointer}"]});let o=s;return o})();export{re as CityComponent};
